"use strict";(globalThis.webpackChunkearthnut_doc_of_docusaurus=globalThis.webpackChunkearthnut_doc_of_docusaurus||[]).push([[4224],{13670(n,e,r){r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>a});var t=r(97671),o=r(56730),i=r(25502);const s={title:"\u8ba4\u8bc6 eslint \u63d2\u4ef6",authors:["Mr.MudBean"],description:"\u5b66\u4e60\u548c\u5236\u4f5c\u7b80\u5355\u7684 eslint \u63d2\u4ef6",hide_title:!0,date:"2026-01-30 04:10",last_update:{date:"2026-02-04 21:23",author:"Mr.MudBean"}},l=void 0,d={authorsImageUrls:[void 0]},a=[{value:"\u4e00\u3001\u6253\u5305\u6838\u5fc3\u539f\u7406",id:"\u4e00\u6253\u5305\u6838\u5fc3\u539f\u7406",level:2},{value:"1. \u5165\u53e3\u5206\u6790\u4e0e\u4f9d\u8d56\u56fe\u6784\u5efa",id:"1-\u5165\u53e3\u5206\u6790\u4e0e\u4f9d\u8d56\u56fe\u6784\u5efa",level:3},{value:"2. \u63d2\u4ef6\u751f\u547d\u5468\u671f\u6267\u884c\uff08\u6838\u5fc3\u6269\u5c55\u70b9\uff09",id:"2-\u63d2\u4ef6\u751f\u547d\u5468\u671f\u6267\u884c\u6838\u5fc3\u6269\u5c55\u70b9",level:3},{value:"3. AST \u89e3\u6790\u4e0e\u8f6c\u6362",id:"3-ast-\u89e3\u6790\u4e0e\u8f6c\u6362",level:3},{value:"4. \u6811\u6447\uff08Tree Shaking\uff09",id:"4-\u6811\u6447tree-shaking",level:3},{value:"5. \u4ea7\u7269\u751f\u6210\u4e0e\u8f93\u51fa",id:"5-\u4ea7\u7269\u751f\u6210\u4e0e\u8f93\u51fa",level:3},{value:"\u4e8c\u3001\u63d2\u4ef6\u5de5\u4f5c\u539f\u7406",id:"\u4e8c\u63d2\u4ef6\u5de5\u4f5c\u539f\u7406",level:2},{value:"1. \u63d2\u4ef6\u7684\u672c\u8d28",id:"1-\u63d2\u4ef6\u7684\u672c\u8d28",level:3},{value:"2. \u6838\u5fc3\u94a9\u5b50",id:"2-\u6838\u5fc3\u94a9\u5b50",level:3},{value:"3. \u63d2\u4ef6\u5b9e\u73b0\u7684\u6838\u5fc3\u6280\u672f",id:"3-\u63d2\u4ef6\u5b9e\u73b0\u7684\u6838\u5fc3\u6280\u672f",level:3},{value:"\u4e09\u3001\u5c0f\u63d2\u4ef6\uff1a rollup \u7248\u79fb\u9664\u6253\u5370\u72d7",id:"\u4e09\u5c0f\u63d2\u4ef6-rollup-\u7248\u79fb\u9664\u6253\u5370\u72d7",level:2},{value:"1. \u5b89\u88c5\u4f9d\u8d56",id:"1-\u5b89\u88c5\u4f9d\u8d56",level:3},{value:"2. \u4ee3\u7801\u7247\u6bb5",id:"2-\u4ee3\u7801\u7247\u6bb5",level:3},{value:"3. \u63d2\u4ef6\u4f7f\u7528\u65b9\u5f0f",id:"3-\u63d2\u4ef6\u4f7f\u7528\u65b9\u5f0f",level:3}];function c(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u662f\u4e00\u6b3e",(0,o.jsx)(e.strong,{children:"\u9762\u5411 ES \u6a21\u5757\uff08ESM\uff09"})," \u7684\u6253\u5305\u5de5\u5177\u3002\u5176\u6838\u5fc3\u4f18\u52bf\u662f\u300c\u6447\u6811\uff08Tree Shaking\uff09\u300d\u548c\u6253\u5305\u4ea7\u7269\u7b80\u6d01\u3002"]}),"\n",(0,o.jsxs)(e.admonition,{title:"\u542c\u4eba\u529d\uff0c\u5403\u9971\u996d",type:"info",children:[(0,o.jsx)(e.p,{children:"\u8be5\u63d2\u4ef6\u522b\u6ca1\u6709\u53d1\u5e03\uff0c\u539f\u56e0\u6709\u4e09\uff1a"}),(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"\u8be5\u9700\u6c42\u4e0d\u6b63\u5e38\uff0c\u8fd9\u79cd\u5783\u573e\u63d2\u4ef6\u53d1\u5e03\u4e86\u4e5f\u4e0d\u4f1a\u6709\u4eba\u4e0b\u8f7d\u4f7f\u7528"}),"\n",(0,o.jsx)(e.li,{children:"\u63d2\u4ef6\u672c\u8eab\u5bf9\u6253\u5305\u4f1a\u9020\u6210\u6027\u80fd\u5f71\u54cd"}),"\n",(0,o.jsx)(e.li,{children:"\u4f7f\u7528 rollup \u672c\u8eab\u4f18\u79c0\u7684 Tree-Shaking \u80fd\u529b\u80dc\u4e8e\u753b\u86c7\u6dfb\u8db3"}),"\n"]})]}),"\n","\n",(0,o.jsx)(e.h2,{id:"\u4e00\u6253\u5305\u6838\u5fc3\u539f\u7406",children:"\u4e00\u3001\u6253\u5305\u6838\u5fc3\u539f\u7406"}),"\n",(0,o.jsx)(e.h3,{id:"1-\u5165\u53e3\u5206\u6790\u4e0e\u4f9d\u8d56\u56fe\u6784\u5efa",children:"1. \u5165\u53e3\u5206\u6790\u4e0e\u4f9d\u8d56\u56fe\u6784\u5efa"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d input \u914d\u7f6e\u7684\u5165\u53e3\u6587\u4ef6\u5f00\u59cb\uff0c\u901a\u8fc7\u9759\u6001\u5206\u6790 ES \u6a21\u5757\u7684 import/export \u8bed\u53e5\uff0c\u9012\u5f52\u904d\u5386\u6240\u6709\u4f9d\u8d56\u6a21\u5757\uff0c\u4e0d\u4f1a\u6267\u884c\u4ee3\u7801\uff08\u8fd9\u662f Tree Shaking \u7684\u57fa\u7840\uff09\uff0c\u6700\u7ec8\u6784\u5efa\u51fa\u4e00\u4e2a\u300c\u6a21\u5757\u4f9d\u8d56\u56fe\u300d\uff0c\u8bb0\u5f55\u6240\u6709\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u3001\u5bfc\u51fa\u5185\u5bb9\u3001\u5bfc\u5165\u5185\u5bb9\u3002"]}),"\n",(0,o.jsx)(e.h3,{id:"2-\u63d2\u4ef6\u751f\u547d\u5468\u671f\u6267\u884c\u6838\u5fc3\u6269\u5c55\u70b9",children:"2. \u63d2\u4ef6\u751f\u547d\u5468\u671f\u6267\u884c\uff08\u6838\u5fc3\u6269\u5c55\u70b9\uff09"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u672c\u8eab\u6838\u5fc3\u529f\u80fd\u6709\u9650\uff0c\u6240\u6709\u81ea\u5b9a\u4e49\u8f6c\u6362\u3001\u8def\u5f84\u89e3\u6790\u3001\u6587\u4ef6\u52a0\u8f7d\u7b49\u80fd\u529b\u90fd\u4f9d\u8d56\u63d2\u4ef6\u3002\u5728\u6253\u5305\u7684\u5404\u4e2a\u9636\u6bb5\uff0cRollup \u4f1a\u6309\u987a\u5e8f\u8c03\u7528\u63d2\u4ef6\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u5bf9\u6a21\u5757\u8fdb\u884c\u5904\u7406\uff08\u8fd9\u90e8\u5206\u662f\u5b9e\u73b0\u4f60\u9700\u6c42\u7684\u6838\u5fc3\uff09\u3002"]}),"\n",(0,o.jsx)(e.h3,{id:"3-ast-\u89e3\u6790\u4e0e\u8f6c\u6362",children:"3. AST \u89e3\u6790\u4e0e\u8f6c\u6362"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u5185\u7f6e acorn \u89e3\u6790\u5668\uff0c\u4f1a\u5c06\u6bcf\u4e2a\u6a21\u5757\u7684\u4ee3\u7801\u89e3\u6790\u4e3a ESTree \u89c4\u8303\u7684\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09\u3002\u6240\u6709\u4ee3\u7801\u7684\u4fee\u6539\u3001\u66ff\u6362\u3001\u79fb\u9664\uff0c\u90fd\u4e0d\u662f\u76f4\u63a5\u64cd\u4f5c\u5b57\u7b26\u4e32\uff08\u6613\u51fa\u9519\uff09\uff0c\u800c\u662f\u901a\u8fc7\u64cd\u4f5c AST \u8282\u70b9\u5b9e\u73b0\u7684\uff0c\u4fee\u6539\u5b8c\u6210\u540e\u518d\u5c06 AST \u8f6c\u6362\u56de\u53ef\u6267\u884c\u7684 JS \u4ee3\u7801\u3002"]}),"\n",(0,o.jsx)(e.h3,{id:"4-\u6811\u6447tree-shaking",children:"4. \u6811\u6447\uff08Tree Shaking\uff09"}),"\n",(0,o.jsx)(e.p,{children:"\u57fa\u4e8e ES \u6a21\u5757\u7684\u300c\u9759\u6001\u7279\u6027\u300d\uff08 import/export \u53ea\u80fd\u5728\u6a21\u5757\u9876\u5c42\uff0c\u4e0d\u80fd\u52a8\u6001\u5224\u65ad\u3001\u4e0d\u80fd\u5d4c\u5957\u5728\u4ee3\u7801\u5757\u4e2d\uff09\uff0cRollup \u4f1a\u5206\u6790\u6a21\u5757\u4f9d\u8d56\u56fe\uff0c\u79fb\u9664\u6240\u6709\u672a\u88ab\u4f7f\u7528\u7684\u5bfc\u51fa\u5185\u5bb9\u548c\u6b7b\u4ee3\u7801\uff0c\u51cf\u5c11\u6253\u5305\u4ea7\u7269\u4f53\u79ef\u3002\u4f60\u7684\u9700\u6c42 2\u30013 \u672c\u8d28\u4e0a\u662f\u300c\u589e\u5f3a\u7248\u6811\u6447\u300d\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u63d2\u4ef6\u8f85\u52a9\u5b9e\u73b0\u3002"}),"\n",(0,o.jsx)(e.h3,{id:"5-\u4ea7\u7269\u751f\u6210\u4e0e\u8f93\u51fa",children:"5. \u4ea7\u7269\u751f\u6210\u4e0e\u8f93\u51fa"}),"\n",(0,o.jsx)(e.p,{children:"\u6839\u636e\u914d\u7f6e\u6587\u4ef6 output \u4e2d\u7684\u683c\u5f0f\uff08 es/cjs/umd \u7b49\uff09\u3001\u8f93\u51fa\u8def\u5f84\u3001\u62c6\u5206\u7b56\u7565\u7b49\uff0c\u5c06\u5904\u7406\u540e\u7684\u6240\u6709\u6a21\u5757\u5408\u5e76\uff0c\u751f\u6210\u6700\u7ec8\u7684\u6253\u5305\u6587\u4ef6\uff0c\u82e5\u914d\u7f6e\u4e86 sourcemap \uff0c\u8fd8\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u6e90\u7801\u6620\u5c04\u6587\u4ef6\u3002"}),"\n",(0,o.jsx)(e.h2,{id:"\u4e8c\u63d2\u4ef6\u5de5\u4f5c\u539f\u7406",children:"\u4e8c\u3001\u63d2\u4ef6\u5de5\u4f5c\u539f\u7406"}),"\n",(0,o.jsx)(e.h3,{id:"1-\u63d2\u4ef6\u7684\u672c\u8d28",children:"1. \u63d2\u4ef6\u7684\u672c\u8d28"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u63d2\u4ef6\u662f\u4e00\u4e2a\u300c\u8fd4\u56de\u94a9\u5b50\u5bf9\u8c61\u7684\u51fd\u6570\u300d\uff0c\u51fd\u6570\u53ef\u4ee5\u63a5\u6536\u63d2\u4ef6\u914d\u7f6e\u53c2\u6570\uff0c\u8fd4\u56de\u7684\u5bf9\u8c61\u4e2d\u5305\u542b\u4e86 ",(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u6253\u5305\u751f\u547d\u5468\u671f\u7684\u5404\u79cd\u94a9\u5b50\uff0c ",(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u5728\u5bf9\u5e94\u9636\u6bb5\u4f1a\u81ea\u52a8\u8c03\u7528\u8fd9\u4e9b\u94a9\u5b50\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",metastring:'showLineNumbers title="javascript"',children:"function customRollupPlugin(options = {}) {\n  return {\n    // \u63d2\u4ef6\u540d\u79f0\uff0c\u7528\u4e8e\u62a5\u9519\u4fe1\u606f\u548c\u65e5\u5fd7\u6807\u8bc6\uff0c\u5fc5\u586b\n    name: 'custom-transform-plugin',\n    // \u5404\u79cd\u751f\u547d\u5468\u671f\u94a9\u5b50\n    options(config) {\n      /* \u4fee\u6539\u6253\u5305\u914d\u7f6e */\n    },\n    resolveId(source) {\n      /* \u89e3\u6790\u6a21\u5757\u771f\u5b9e\u8def\u5f84 */\n    },\n    transform(code, id) {\n      /* \u8f6c\u6362\u6a21\u5757\u4ee3\u7801\uff0c\u6838\u5fc3\u5b9e\u73b0\u9700\u6c42 */\n    },\n    generateBundle(outputOptions, bundle) {\n      /* \u5904\u7406\u751f\u6210\u540e\u7684\u4ea7\u7269 */\n    },\n  };\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"2-\u6838\u5fc3\u94a9\u5b50",children:"2. \u6838\u5fc3\u94a9\u5b50"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"options"})," \uff1a\u6253\u5305\u5f00\u59cb\u524d\u6267\u884c\uff0c\u7528\u4e8e\u4fee\u6539 ",(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u539f\u59cb\u914d\u7f6e\uff08\u6bd4\u5982\u8865\u5145\u8f93\u51fa\u683c\u5f0f\uff09\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"resolveId"})," \uff1a\u89e3\u6790\u6a21\u5757 ID\uff08\u8def\u5f84\uff09\uff0c\u7528\u4e8e\u5904\u7406\u522b\u540d\u3001\u7b2c\u4e09\u65b9\u5305\u3001\u865a\u62df\u6a21\u5757\uff08\u6bd4\u5982\u8fd4\u56de\u81ea\u5b9a\u4e49\u6a21\u5757 ID \u5c4f\u853d\u539f\u59cb\u6a21\u5757\uff09\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"load"})," \uff1a\u6839\u636e\u6a21\u5757 ID \u52a0\u8f7d\u6a21\u5757\u5185\u5bb9\uff0c\u7528\u4e8e\u52a0\u8f7d\u975e JS \u6587\u4ef6\u3001\u865a\u62df\u6a21\u5757\u5185\u5bb9\uff08\u6bd4\u5982\u8fd4\u56de\u81ea\u5b9a\u4e49\u4ee3\u7801\u66ff\u6362\u539f\u59cb\u6a21\u5757\uff09\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"transform"})," \uff1a\u52a0\u8f7d\u6a21\u5757\u540e\u3001AST \u5206\u6790\u524d\u6267\u884c\uff0c\u63a5\u6536\u6a21\u5757\u4ee3\u7801\u548c\u6a21\u5757 ID\uff0c\u8fd4\u56de\u4fee\u6539\u540e\u7684\u4ee3\u7801\u548c sourcemap\u3002\u8fd9\u662f\u5b9e\u73b0\u300c\u4ee3\u7801\u8f6c\u6362 / \u79fb\u9664\u300d\u7684\u6838\u5fc3\u94a9\u5b50\uff0c\u6211\u4eec\u4f1a\u5728\u8fd9\u91cc\u64cd\u4f5c AST \u5b8c\u6210\u6240\u6709\u9700\u6c42"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"3-\u63d2\u4ef6\u5b9e\u73b0\u7684\u6838\u5fc3\u6280\u672f",children:"3. \u63d2\u4ef6\u5b9e\u73b0\u7684\u6838\u5fc3\u6280\u672f"}),"\n",(0,o.jsx)(e.p,{children:"\u8981\u5b9e\u73b0\u4ee3\u7801\u7684\u7cbe\u51c6\u8f6c\u6362 / \u79fb\u9664\uff0c\u4e0d\u80fd\u76f4\u63a5\u7528\u5b57\u7b26\u4e32\u66ff\u6362\uff08\u6613\u51fa\u73b0\u8fb9\u754c\u9519\u8bef\uff0c\u6bd4\u5982\u8bef\u5339\u914d\u53d8\u91cf\u540d\uff09\uff0c\u6838\u5fc3\u4f9d\u8d56 3 \u4e2a\u5de5\u5177\u5e93\uff1a"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"estree-walker"})," \uff1a\u904d\u5386 ESTree \u89c4\u8303\u7684 AST \u8282\u70b9\uff0c\u65b9\u4fbf\u627e\u5230\u9700\u8981\u4fee\u6539 / \u79fb\u9664\u7684\u8282\u70b9\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"magic-string"})," \uff1a\u5b89\u5168\u4fee\u6539\u4ee3\u7801\u5b57\u7b26\u4e32\uff0c\u540c\u65f6\u4fdd\u7559 sourcemap\uff08\u907f\u514d\u6253\u5305\u540e\u65e0\u6cd5\u6620\u5c04\u5230\u6e90\u7801\uff0c\u96be\u4ee5\u8c03\u8bd5\uff09\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.code,{children:"@rollup/pluginutils"})," \uff1a\u63d0\u4f9b\u5b9e\u7528\u5de5\u5177\uff08\u6bd4\u5982 createFilter\uff09\uff0c\u7528\u4e8e\u8fc7\u6ee4\u9700\u8981\u5904\u7406\u7684\u6587\u4ef6\uff08\u6bd4\u5982\u53ea\u5904\u7406 .js/.ts \u6587\u4ef6\uff0c\u5ffd\u7565 node_modules\uff09"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u4e09\u5c0f\u63d2\u4ef6-rollup-\u7248\u79fb\u9664\u6253\u5370\u72d7",children:"\u4e09\u3001\u5c0f\u63d2\u4ef6\uff1a rollup \u7248\u79fb\u9664\u6253\u5370\u72d7"}),"\n",(0,o.jsx)(e.h3,{id:"1-\u5b89\u88c5\u4f9d\u8d56",children:"1. \u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# Rollup \u5185\u7f6e\uff0c\u4f46\u5355\u72ec\u5b89\u88c5\u53ef\u4fdd\u8bc1\u7248\u672c\u4e00\u81f4\uff0c\u7528\u4e8e\u89e3\u6790\u4ee3\u7801\u4e3a AST\nnpm install --save-dev estree-walker magic-string @rollup/pluginutils acorn\n"})}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsx)(e.p,{children:"\u82e5\u9700\u8981\u5904\u7406 TypeScript \u6587\u4ef6\uff0c\u8fd8\u9700\u8981\u5b89\u88c5 @rollup/plugin-typescript \u548c typescript\uff0c\u4e14\u81ea\u5b9a\u4e49\u63d2\u4ef6\u8981\u653e\u5728 typescript \u63d2\u4ef6\u4e4b\u540e\u6267\u884c"})}),"\n",(0,o.jsx)(e.h3,{id:"2-\u4ee3\u7801\u7247\u6bb5",children:"2. \u4ee3\u7801\u7247\u6bb5"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",metastring:"showLineNumbers",children:"// \u81ea\u5b9a\u4e49 Rollup \u63d2\u4ef6\uff1aprod\u73af\u5883\u4e0b\u4ee3\u7801\u8f6c\u6362\u4e0e\u6b7b\u4ee3\u7801\u79fb\u9664\nimport acorn from 'acorn';\nimport { walk } from 'estree-walker';\nimport MagicString from 'magic-string';\nimport { createFilter } from '@rollup/pluginutils';\n\nfunction prodCodeTransformPlugin(options = {}) {\n  // \u8fc7\u6ee4\u9700\u8981\u5904\u7406\u7684\u6587\u4ef6\uff1a\u9ed8\u8ba4\u5904\u7406 .js/.ts \u6587\u4ef6\uff0c\u5ffd\u7565 node_modules\n  const filter = createFilter(\n    options.include || ['**/*.js', '**/*.ts'],\n    options.exclude || ['node_modules/**'],\n  );\n\n  // \u5224\u65ad\u662f\u5426\u4e3a production \u73af\u5883\n  const isProduction = process.env.NODE_ENV === 'production';\n\n  return {\n    name: 'qqi-rollup-plugin-remove-dog', // \u63d2\u4ef6\u540d\u79f0\uff0c\u5fc5\u586b\n    /**\n     * \u6838\u5fc3\u8f6c\u6362\u94a9\u5b50\uff1a\u5904\u7406\u6bcf\u4e2a\u6a21\u5757\u7684\u4ee3\u7801\n     * @param {string} code - \u6a21\u5757\u539f\u59cb\u4ee3\u7801\n     * @param {string} id - \u6a21\u5757 ID\uff08\u6587\u4ef6\u8def\u5f84\uff09\n     * @returns {object|void} - \u4fee\u6539\u540e\u7684\u4ee3\u7801\u548c sourcemap\n     */\n    transform(code, id) {\n      // 1. \u975e production \u73af\u5883\u3001\u65e0\u9700\u5904\u7406\u7684\u6587\u4ef6\uff0c\u76f4\u63a5\u8fd4\u56de\n      if (!isProduction || !filter(id)) return;\n\n      // 2. \u521d\u59cb\u5316 MagicString\uff0c\u7528\u4e8e\u5b89\u5168\u4fee\u6539\u4ee3\u7801\u5e76\u4fdd\u7559 sourcemap\n      const magicStr = new MagicString(code);\n      // 3. \u89e3\u6790\u4ee3\u7801\u4e3a AST\uff08ESTree \u89c4\u8303\uff09\n      let ast;\n      try {\n        ast = acorn.parse(code, {\n          ecmaVersion: 'latest',\n          sourceType: 'module', // \u6309 ES \u6a21\u5757\u89e3\u6790\n          ranges: true, // \u4fdd\u7559\u8282\u70b9\u7684\u4f4d\u7f6e\u8303\u56f4\uff08start/end\uff09\uff0c\u65b9\u4fbf magicStr \u64cd\u4f5c\n          locations: true,\n        });\n      } catch (err) {\n        this.warn(`\u89e3\u6790\u6a21\u5757 ${id} \u5931\u8d25\uff1a${err.message}`);\n        return;\n      }\n\n      // \u6807\u8bb0\uff1a\u662f\u5426\u5b58\u5728 dun = false\uff08\u7528\u4e8e\u540e\u7eed\u79fb\u9664 if (dun) \u4ee3\u7801\u5757\uff09\n      let hasDunFalse = false;\n      // \u5b58\u50a8\u9700\u8981\u79fb\u9664\u7684\u4ee3\u7801\u8282\u70b9\u8303\u56f4\uff08\u907f\u514d\u91cd\u590d\u64cd\u4f5c\uff09\n      const removeRanges = new Set();\n\n      // 4. \u904d\u5386 AST\uff0c\u5904\u7406\u6240\u6709\u9700\u6c42\n      walk(ast, {\n        // \u8fdb\u5165 AST \u8282\u70b9\u65f6\u89e6\u53d1\uff08\u6838\u5fc3\u5904\u7406\u903b\u8f91\uff09\n        enter(node) {\n          /************************** \u9700\u6c42 1\uff1a\u8f6c\u6362 Dog \u5bfc\u5165 **************************/\n          if (\n            node.type === 'ImportDeclaration' &&\n            node.source.value === '@qqi/log'\n          ) {\n            // \u904d\u5386 import \u58f0\u660e\u7684\u6240\u6709\u547d\u540d\u5bfc\u5165\n            node.specifiers.forEach(specifier => {\n              // \u5339\u914d\uff1aimport { Dog } from '@qqi/log'\n              if (\n                specifier.type === 'ImportSpecifier' &&\n                specifier.imported.name === 'Dog'\n              ) {\n                // \u627e\u5230 Dog \u5bf9\u5e94\u7684\u4ee3\u7801\u8d77\u59cb\u548c\u7ed3\u675f\u4f4d\u7f6e\uff0c\u66ff\u6362\u4e3a DogVirtual\n                const importedNameStart = specifier.imported.start;\n                const importedNameEnd = specifier.imported.end;\n                magicStr.overwrite(\n                  importedNameStart,\n                  importedNameEnd,\n                  'DogVirtual',\n                );\n              }\n            });\n          }\n\n          /************************** \u9700\u6c42 2\uff1a\u79fb\u9664 dog \u76f8\u5173\u5bfc\u5165\u548c\u8c03\u7528 **************************/\n          // 2.1 \u79fb\u9664 import { dog } from 'xxx'\n          if (node.type === 'ImportDeclaration') {\n            let needRemoveImport = false;\n            // \u6807\u8bb0\u662f\u5426\u53ea\u5bfc\u5165\u4e86 dog\uff08\u82e5\u6709\u5176\u4ed6\u5bfc\u5165\uff0c\u53ea\u79fb\u9664 dog \u5bf9\u5e94\u7684\u90e8\u5206\uff09\n            let onlyDogImport = node.specifiers.length === 1;\n\n            node.specifiers.forEach((specifier, index) => {\n              if (\n                specifier.type === 'ImportSpecifier' &&\n                specifier.imported.name === 'dog'\n              ) {\n                if (onlyDogImport) {\n                  // \u6574\u4e2a import \u8bed\u53e5\u90fd\u79fb\u9664\n                  removeRanges.add(`${node.start}-${node.end}`);\n                  needRemoveImport = true;\n                } else {\n                  // \u53ea\u79fb\u9664 dog \u5bf9\u5e94\u7684\u90e8\u5206\uff08\u5904\u7406\u9017\u53f7\u5206\u9694\uff09\n                  const specStart = specifier.start;\n                  const specEnd = node.specifiers[index + 1]\n                    ? node.specifiers[index + 1].start - 1\n                    : node.end;\n                  removeRanges.add(`${specStart}-${specEnd}`);\n                }\n              }\n            });\n\n            // \u82e5\u6807\u8bb0\u4e86\u79fb\u9664\u6574\u4e2a import\uff0c\u76f4\u63a5\u8df3\u8fc7\u540e\u7eed\u5904\u7406\n            if (needRemoveImport) return;\n          }\n\n          // 2.2 \u79fb\u9664 dog('xxx')\u3001dog.warn('xxx')\u3001dog.error('xxx')\n          if (node.type === 'CallExpression') {\n            let isDogCall = false;\n\n            // \u5339\u914d\uff1adog('xxx')\uff08\u76f4\u63a5\u8c03\u7528\uff09\n            if (\n              node.callee.type === 'Identifier' &&\n              node.callee.name === 'dog'\n            ) {\n              isDogCall = true;\n            }\n\n            // \u5339\u914d\uff1adog.warn('xxx')\u3001dog.error('xxx')\uff08\u6210\u5458\u8c03\u7528\uff09\n            if (\n              node.callee.type === 'MemberExpression' &&\n              node.callee.object.type === 'Identifier' &&\n              node.callee.object.name === 'dog' &&\n              ['warn', 'error', 'info', 'type'].includes(\n                node.callee.property.name,\n              )\n            ) {\n              isDogCall = true;\n            }\n\n            // \u6807\u8bb0\u9700\u8981\u79fb\u9664\u7684\u8c03\u7528\u8bed\u53e5\u8303\u56f4\n            if (isDogCall) {\n              removeRanges.add(`${node.start}-${node.end}`);\n            }\n          }\n\n          /************************** \u9700\u6c42 3\uff1a\u79fb\u9664 dun \u76f8\u5173\u5bfc\u51fa\u548c if \u4ee3\u7801\u5757 **************************/\n          // 3.1 \u5339\u914d\uff1aexport const dun = false\n          if (\n            node.type === 'ExportNamedDeclaration' &&\n            node.declaration &&\n            node.declaration.type === 'VariableDeclaration' &&\n            node.declaration.kind === 'const'\n          ) {\n            node.declaration.declarations.forEach(declaration => {\n              if (\n                declaration.id.name === 'dun' &&\n                declaration.init &&\n                declaration.init.type === 'Literal' &&\n                (declaration.init.value === false ||\n                  declaration.init.value === true)\n              ) {\n                // \u6807\u8bb0\u5b58\u5728 dun = false\uff0c\u4e14\u79fb\u9664\u8be5\u5bfc\u51fa\u8bed\u53e5\n                hasDunFalse = true;\n                removeRanges.add(`${node.start}-${node.end}`);\n              }\n            });\n          }\n\n          // 3.2 \u5339\u914d\uff1aif (dun) { ... }\uff08\u4ec5\u5f53 hasDunFalse \u4e3a true \u65f6\u79fb\u9664\uff09\n          if (hasDunFalse && node.type === 'IfStatement') {\n            const testNode = node.test;\n            if (testNode.type === 'Identifier' && testNode.name === 'dun') {\n              // \u79fb\u9664\u6574\u4e2a if \u8bed\u53e5\u5757\n              removeRanges.add(`${node.start}-${node.end}`);\n            }\n          }\n        },\n      });\n\n      // 5. \u6267\u884c\u4ee3\u7801\u79fb\u9664\uff08\u5904\u7406\u6240\u6709\u6807\u8bb0\u7684\u79fb\u9664\u8303\u56f4\uff09\n      Array.from(removeRanges).forEach(range => {\n        const [start, end] = range.split('-').map(Number);\n        magicStr.remove(start, end);\n      });\n\n      // 6. \u8fd4\u56de\u4fee\u6539\u540e\u7684\u4ee3\u7801\u548c sourcemap\n      return {\n        code: magicStr.toString(),\n        map: magicStr.generateMap({ hires: true }), // \u751f\u6210\u9ad8\u7cbe\u5ea6 sourcemap\n      };\n    },\n  };\n}\n\nmodule.exports = prodCodeTransformPlugin;\n"})}),"\n",(0,o.jsx)(e.h3,{id:"3-\u63d2\u4ef6\u4f7f\u7528\u65b9\u5f0f",children:"3. \u63d2\u4ef6\u4f7f\u7528\u65b9\u5f0f"}),"\n",(0,o.jsxs)(e.p,{children:["\u5728 ",(0,o.jsx)(e.a,{href:"https://cn.rollupjs.org/",children:"Rollup"})," \u914d\u7f6e\u6587\u4ef6\uff08",(0,o.jsx)(e.code,{children:"rollup.config.js"}),"\uff09\u4e2d\u5f15\u5165\u5e76\u4f7f\u7528\u8be5\u63d2\u4ef6\uff1a"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",metastring:"showLineNumbers",children:"const prodCodeTransform = require('./prodCodeTransformPlugin');\nconst { terser } = require('rollup-plugin-terser'); // \u53ef\u9009\uff0cproduction \u73af\u5883\u538b\u7f29\u4ee3\u7801\n\nmodule.exports = {\n  input: 'src/index.js', // \u4f60\u7684\u5165\u53e3\u6587\u4ef6\n  output: {\n    file: 'dist/bundle.js',\n    format: 'es', // \u8f93\u51fa ES \u6a21\u5757\n  },\n  plugins: [\n    // \u5f15\u5165\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u653e\u5728\u5176\u4ed6\u8f6c\u6362\u63d2\u4ef6\u4e4b\u540e\uff08\u6bd4\u5982 ts \u63d2\u4ef6\uff09\n    prodCodeTransform(),\n    // \u53ef\u9009\uff1aproduction \u73af\u5883\u538b\u7f29\u4ee3\u7801\uff08\u5efa\u8bae\u6dfb\u52a0\uff09\n    process.env.NODE_ENV === 'production' && terser(),\n  ],\n};\n"})})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}},25502(n,e,r){r.d(e,{R:()=>s,x:()=>l});var t=r(10162);const o={},i=t.createContext(o);function s(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),t.createElement(i.Provider,{value:e},n.children)}},97671(n){n.exports=JSON.parse('{"permalink":"/\u5efa\u7ad9\u65e5\u5fd7/2026/1/30/\u8ba4\u8bc6 eslint \u63d2\u4ef6","source":"@site/website-log/2026/1/30-\u8ba4\u8bc6 eslint \u63d2\u4ef6.mdx","title":"\u8ba4\u8bc6 eslint \u63d2\u4ef6","description":"\u5b66\u4e60\u548c\u5236\u4f5c\u7b80\u5355\u7684 eslint \u63d2\u4ef6","date":"2026-01-30T04:10:00.000Z","tags":[],"readingTime":7.19,"hasTruncateMarker":true,"authors":[{"name":"\u6ce5\u8c46\u541b","title":"\u54c7\uff01\u662f\u6ce5\u8c46\u4fa0\uff0c\u6211\u4eec\u6ca1\u6551\u4e86","url":"https://github.com/MrMudBean","page":{"permalink":"/\u5efa\u7ad9\u65e5\u5fd7/authors/mr-mud-bean"},"socials":{"x":"https://x.com/MrMudBean","github":"https://github.com/MrMudBean","npm":"https://npmjs.org/~mr.mudbean","email":"mailto:Mr.MudBean@outlook.com"},"imageURL":"/icon/dev/logo.png","key":"Mr.MudBean"}],"frontMatter":{"title":"\u8ba4\u8bc6 eslint \u63d2\u4ef6","authors":["Mr.MudBean"],"description":"\u5b66\u4e60\u548c\u5236\u4f5c\u7b80\u5355\u7684 eslint \u63d2\u4ef6","hide_title":true,"date":"2026-01-30 04:10","last_update":{"date":"2026-02-04 21:23","author":"Mr.MudBean"}},"unlisted":false,"lastUpdatedAt":1770211380000,"prevItem":{"title":"eslint \u4e0e scss","permalink":"/\u5efa\u7ad9\u65e5\u5fd7/2026/2/4/eslint-scss"},"nextItem":{"title":"vs Code \u6269\u5c55\u5b50\u547d\u4ee4\u83dc\u5355","permalink":"/\u5efa\u7ad9\u65e5\u5fd7/2026/1/1/vsCode \u63d2\u4ef6\u5b50\u547d\u4ee4\u914d\u7f6e"}}')}}]);